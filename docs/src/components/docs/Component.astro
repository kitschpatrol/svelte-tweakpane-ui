---
import AnchorHeading from '@astrojs/starlight/components/AnchorHeading.astro'
import type { ComponentData } from '../../utils/prop-utilities'
import { allPropConditions, allProps } from '../../utils/prop-utilities'
import DynamicPropAdmonition from './DynamicPropAdmonition.mdx'
import ExampleWrapper from './ExampleWrapper.astro'
import PropTable from './PropTable.astro'
// Bypasses any markdown customization in starlight...
import { marked } from 'marked'

type Props = {
	componentData: ComponentData
}

const { componentData: data } = Astro.props

// eslint-disable-next-line ts/naming-convention, unicorn/no-await-expression-member, ts/no-unsafe-assignment, ts/no-unsafe-member-access
const ExampleCode = (await import(`../../examples/components/${data?.name}Example.md`)).default

const hasExample = Boolean(data?.jsDocs?.example)
const hasProps = Boolean(data?.props.length)
const hasDynamicProps = Boolean(data?.dynamicProps?.length)
const hasEvents = Boolean(data?.events.length)
const hasSlots = Boolean(data?.slots.length)
---

{
	data && (
		<>
			<Fragment set:html={marked.parse(data.doc)} />
			{hasExample && (
				<>
					<hr />
					<AnchorHeading id="example" level={2} set:text="Example" />
					<AnchorHeading id="demo" level={3} set:text="Demo" />
					<ExampleWrapper>
						<slot />
					</ExampleWrapper>
					<AnchorHeading id="code" level={3} set:text="Code" />
					<ExampleCode />
				</>
			)}
			{hasProps && (
				<>
					<hr />
					<AnchorHeading id="props" level={2} set:text="Props" />
					{hasDynamicProps ? (
						<>
							<DynamicPropAdmonition />
							<PropTable conditionData={allPropConditions(data)} data={allProps(data)} />
						</>
					) : (
						<PropTable data={data.props} />
					)}
				</>
			)}
			{hasEvents && (
				<>
					<hr />
					<AnchorHeading id="events" level={2} set:text="Events" />
					<PropTable data={data.events} showDefault={false} showFlags={false} />
				</>
			)}
			{hasSlots && (
				<>
					<hr />
					<AnchorHeading id="slots" level={2} set:text="Slots" />
					<PropTable data={data.slots} showDefault={false} showFlags={false} />
				</>
			)}
		</>
	)
}
